<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ä»Šå¤©åƒä»€ä¹ˆé¸­ï¼Ÿ</title>
    <style>
        :root { --bg: #FFF3E0; --card-bg: #FFFFFF; --primary: #FF8A80; --text: #5D4037; }
        body { margin: 0; padding: 20px; background: var(--bg); font-family: "Microsoft YaHei", sans-serif; text-align: center; color: var(--text); overflow-x: hidden; }
        
        h1 { margin-bottom: 5px; font-size: 1.8rem; }
        p { color: #8d6e63; font-size: 0.9rem; margin-bottom: 30px; }

        .arena {
            display: flex; flex-wrap: wrap; justify-content: center; gap: 12px;
            max-width: 1000px; margin: 0 auto 100px auto; /* åº•éƒ¨ç•™ç™½ç»™æŒ‰é’® */
        }

        .card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 12px 20px;
            font-size: 1rem;
            font-weight: bold;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            display: flex; align-items: center; gap: 8px;
            transition: transform 0.2s;
            position: relative;
        }

        /* --- ğŸ’€ éšæœºæ¶ˆå¤±ç‰¹æ•ˆåº“ --- */
        
        /* 1. çˆ†ç‚¸æ¶ˆå¤± */
        @keyframes boom {
            0% { transform: scale(1); }
            50% { transform: scale(1.4); opacity: 1; }
            100% { transform: scale(2); opacity: 0; filter: blur(4px); }
        }
        .die-boom { animation: boom 0.5s ease-out forwards; pointer-events: none; }

        /* 2. å å…¥æ·±æ¸Š */
        @keyframes drop {
            0% { transform: translateY(0) rotate(0); }
            100% { transform: translateY(200px) rotate(45deg); opacity: 0; }
        }
        .die-drop { animation: drop 0.6s ease-in forwards; pointer-events: none; }

        /* 3. çµé­‚å‡å¤© */
        @keyframes fly {
            0% { transform: translateY(0); }
            100% { transform: translateY(-150px); opacity: 0; filter: grayscale(100%); }
        }
        .die-fly { animation: fly 0.7s ease-out forwards; pointer-events: none; }

        /* 4. åƒç´ ç¼©å° */
        @keyframes shrink {
            0% { transform: scale(1); }
            100% { transform: scale(0); opacity: 0; }
        }
        .die-shrink { animation: shrink 0.4s ease-in forwards; pointer-events: none; }

        /* --- ğŸ‘‘ èµ¢å®¶ç‰¹æ•ˆ --- */
        .winner {
            transform: scale(1.3) !important;
            border: 3px solid var(--primary);
            background: #FFEBEE;
            box-shadow: 0 0 30px rgba(255, 138, 128, 0.5);
            z-index: 100;
        }
        .winner::after {
            content: 'ğŸ‘‘'; position: absolute; top: -15px; right: -10px; font-size: 24px;
            animation: bounce 0.6s infinite alternate;
        }
        @keyframes bounce { from { transform: translateY(0); } to { transform: translateY(-5px); } }

        /* --- æŒ‰é’® --- */
        button {
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
            background: linear-gradient(45deg, #FF8A80, #FF5252);
            color: white; border: none; padding: 15px 50px;
            border-radius: 50px; font-size: 1.2rem; font-weight: bold;
            box-shadow: 0 10px 20px rgba(255, 82, 82, 0.3);
            cursor: pointer; transition: transform 0.1s;
        }
        button:active { transform: translateX(-50%) scale(0.95); }
        button:disabled { background: #ccc; box-shadow: none; cursor: not-allowed; }

        /* é”™è¯¯æç¤º */
        #error-msg { color: red; display: none; font-size: 0.8rem; margin-top: 10px; }
    </style>
</head>
<body>

    <h1>âœ¨ åƒä»€ä¹ˆå¤§é€ƒæ€ âœ¨</h1>
    <p>é¤å…ä»¬è¦é€æ¸éšæœºæ¶ˆå¤±äº†å“¦...</p>

    <div class="arena" id="arena"></div>
    <div id="error-msg">âš ï¸ æ²¡æ‰¾åˆ° data.js æ–‡ä»¶ï¼Œè¯·ç¡®ä¿å®ƒå’Œç½‘é¡µåœ¨åŒä¸€æ–‡ä»¶å¤¹å†…ã€‚</div>

    <button onclick="startBattle()" id="btn">å¼€å§‹æ·˜æ±°å’¯</button>

    <script src="data.js" onerror="showError()"></script>

    <script>
        const arena = document.getElementById('arena');
        const btn = document.getElementById('btn');
        let cards = [];
        
        // æ­»äº¡ç‰¹æ•ˆåˆ—è¡¨ï¼ˆå¯¹åº” CSS ä¸­çš„ classï¼‰
        const deathEffects = ['die-boom', 'die-drop', 'die-fly', 'die-shrink'];

        function showError() {
            document.getElementById('error-msg').style.display = 'block';
        }

        // åˆå§‹åŒ–æ¸²æŸ“
        function init() {
            if (!window.restaurantData) {
                showError();
                return;
            }
            arena.innerHTML = '';
            cards = [];
            window.restaurantData.forEach(item => {
                const div = document.createElement('div');
                div.className = 'card';
                div.innerHTML = `<span>${item.icon}</span> ${item.name}`;
                arena.appendChild(div);
                cards.push(div);
            });
        }

        // æ ¸å¿ƒæ¸¸æˆé€»è¾‘
        function startBattle() {
            if (cards.length === 0) return;

            // é‡ç½®çŠ¶æ€ï¼šç§»é™¤æ‰€æœ‰ç‰¹æ•ˆç±»ï¼Œç§»é™¤èµ¢å®¶ç±»
            cards.forEach(card => {
                card.className = 'card'; // æš´åŠ›é‡ç½® class
                // å¼ºåˆ¶é‡ç»˜ï¼Œå¦åˆ™åŠ¨ç”»å¯èƒ½ä¸å›æ”¾
                void card.offsetWidth;
            });

            btn.disabled = true;
            btn.innerText = "ç”Ÿå­˜æ¸¸æˆä¸­...";

            // æ´»è·ƒå¡ç‰‡æ± 
            let activeCards = [...cards];
            let speed = 100; // åˆå§‹é€Ÿåº¦

            function killNext() {
                // èƒœåˆ©åˆ¤å®š
                if (activeCards.length === 1) {
                    const winner = activeCards[0];
                    winner.classList.add('winner');
                    btn.disabled = false;
                    btn.innerText = "å†ç©ä¸€æ¬¡";
                    return;
                }

                // éšæœºé€‰æ‹©å—å®³è€…
                const rIndex = Math.floor(Math.random() * activeCards.length);
                const victim = activeCards[rIndex];

                // éšæœºé€‰æ‹©ç‰¹æ•ˆ
                const rEffect = deathEffects[Math.floor(Math.random() * deathEffects.length)];
                victim.classList.add(rEffect);

                // ä»æ´»è·ƒåˆ—è¡¨ä¸­ç§»é™¤
                activeCards.splice(rIndex, 1);

                // åŠ¨æ€è°ƒæ•´é€Ÿåº¦ï¼šå‰©å¾—è¶Šå°‘ï¼Œé€Ÿåº¦è¶Šæ…¢ï¼ˆç´§å¼ æ„Ÿï¼‰
                const remaining = activeCards.length;
                if (remaining < 5) speed += 100;
                if (remaining === 2) speed += 300; // æœ€åä¸¤åå†³æˆ˜æ—¶æœ€æ…¢

                setTimeout(killNext, speed);
            }

            killNext();
        }

        // é¡µé¢åŠ è½½åå°è¯•åˆå§‹åŒ–
        window.onload = init;
    </script>
</body>
</html>
